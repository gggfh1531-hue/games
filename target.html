<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Target Aim - Ø§Ù„ØªØµÙˆÙŠØ¨</title>
  <style>
    *{box-sizing:border-box}
    body{
      margin:0; overflow:hidden; touch-action:none; user-select:none;
      font-family: system-ui, -apple-system, "Segoe UI", Arial, sans-serif;

      /* âœ… Ø®Ù„ÙÙŠØ© Ø±Ù…Ø§Ø¯ÙŠ ØºØ§Ù…Ù‚ (Ø£ØºÙ…Ù‚ Ø´ÙˆÙŠ) */
      background:
        radial-gradient(1200px 800px at 70% 30%, rgba(255,255,255,0.05), transparent 55%),
        radial-gradient(900px 700px at 20% 70%, rgba(255,255,255,0.04), transparent 60%),
        radial-gradient(1200px 900px at 50% 50%, rgba(0,0,0,0.26), rgba(0,0,0,0.82) 70%),
        #23262b;

      color:#fff;
    }
    canvas{display:block; width:100vw; height:100vh;}

    #hud{
      position:fixed; inset:0 0 auto 0;
      padding:14px 14px 0;
      display:flex; align-items:center; justify-content:space-between;
      pointer-events:none;
      gap:12px;
    }
    .left, .right{display:flex; align-items:center; gap:10px;}
    .shotRow{
      display:flex; gap:8px; align-items:center; justify-content:center;
      pointer-events:none;
    }
    .slot{
      width:58px; height:46px;
      border-radius:10px;
      background: rgba(255,255,255,0.08);
      border: 2px solid rgba(255,255,255,0.12);
      display:flex; align-items:center; justify-content:center;
      font-weight:900; font-size:22px;
      color:#86ff86;
      box-shadow: 0 8px 18px rgba(0,0,0,0.35);
    }
    .slot.q{
      color:rgba(255,255,255,0.55);
      font-weight:800;
    }

    .pill{
      pointer-events:none;
      background: rgba(255,255,255,0.08);
      border: 2px solid rgba(255,255,255,0.12);
      border-radius:14px;
      padding:10px 14px;
      display:flex; align-items:center; gap:10px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.35);
      white-space:nowrap;
    }
    .pill b{font-size:22px}
    .pill span{opacity:0.8}

    .btnBar{
      position:fixed;
      bottom:16px; left:16px; right:16px;
      display:flex; gap:10px; justify-content:center;
      pointer-events:auto;
    }
    button{
      border:none; cursor:pointer;
      border-radius:16px;
      padding:14px 18px;
      font-weight:900;
      font-size:16px;
      background: rgba(255,255,255,0.10);
      color:#fff;
      border: 2px solid rgba(255,255,255,0.14);
      box-shadow: 0 12px 26px rgba(0,0,0,0.45);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      transition: transform .12s ease;
      min-width:140px;
    }
    button:active{transform:scale(0.97)}

    #overlay{
      position:fixed; inset:0;
      display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,0.65);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      z-index:50;
      padding:16px;
    }
    .card{
      width:min(520px, 92vw);
      background: rgba(255,255,255,0.10);
      border: 2px solid rgba(255,255,255,0.16);
      border-radius:22px;
      padding:22px;
      box-shadow: 0 24px 60px rgba(0,0,0,0.55);
      text-align:center;
    }
    .card h1{margin:0 0 8px; font-size:26px}
    .card p{margin:0 0 16px; opacity:0.8; line-height:1.6}
    .card .big{font-size:44px; font-weight:1000; margin:10px 0 12px}
    .card .mini{
      display:flex; gap:8px; justify-content:center; flex-wrap:wrap;
      opacity:0.9;
    }
    .tag{
      padding:8px 12px; border-radius:999px;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.16);
      font-weight:800;
    }
    #hint{
      position:fixed; top:70px; left:50%;
      transform:translateX(-50%);
      background: rgba(0,0,0,0.35);
      border: 1px solid rgba(255,255,255,0.16);
      padding:10px 14px;
      border-radius:999px;
      font-weight:800;
      opacity:0.85;
      z-index:10;
      pointer-events:none;
    }
  </style>
</head>
<body>

  <div id="hud">
    <div class="left">
      <div class="pill"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span> <b id="total">0</b></div>
    </div>

    <div class="shotRow" id="shotRow"></div>

    <div class="right">
      <div class="pill"><span>Ø§Ù„Ø·Ù„Ù‚Ø§Øª</span> <b id="count">0</b><span>/</span><b id="max">5</b></div>
    </div>
  </div>

  <div id="hint">Ø§Ø¶ØºØ· / Ø§Ù†Ù‚Ø± Ù„Ø¥Ø·Ù„Ø§Ù‚ â€” Space</div>

  <canvas id="c"></canvas>

  <div class="btnBar">
    <button id="btnRestart">Ø¥Ø¹Ø§Ø¯Ø©</button>
    <button id="btnHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  </div>

  <div id="overlay">
    <div class="card" id="cardHome">
      <h1>Ø§Ù„ØªØµÙˆÙŠØ¨ ğŸ¯</h1>
      <p>Ø§Ù„ØªØµÙˆÙŠØ¨ ÙŠØªØ­Ø±Ùƒ ÙŠÙ…ÙŠÙ† ÙˆÙŠØ³Ø§Ø± ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø®Ø· Ø§Ù„Ù…Ù†ØªØµÙ (ÙŠÙ…Ø± Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†).<br>ÙƒÙ„ Ø·Ù„Ù‚Ø© ØªÙ†ÙƒØªØ¨ ÙÙˆÙ‚ Ø¨Ø±Ù‚Ù…Ù‡Ø§ ÙˆÙ†ØªÙŠØ¬ØªÙ‡Ø§.</p>
      <div class="big" id="homeBest">Ø¬Ø§Ù‡Ø²ØŸ</div>
      <button id="btnStart" style="width:100%; margin-top:8px;">Ø§Ø¨Ø¯Ø£</button>
    </div>

    <div class="card" id="cardEnd" style="display:none;">
      <h1>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø© âœ…</h1>
      <div class="big"><span id="endTotal">0</span></div>
      <div class="mini" id="endList"></div>
      <div style="display:flex; gap:10px; margin-top:14px;">
        <button id="btnPlayAgain" style="flex:1;">Ø¥Ø¹Ø§Ø¯Ø©</button>
        <button id="btnBackHome" style="flex:1;">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
      </div>
    </div>
  </div>

<script>
(() => {
  const HOME_URL = 'index.html'; // âœ… ØµÙØ­Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨

  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');

  const totalEl = document.getElementById('total');
  const countEl = document.getElementById('count');
  const maxEl = document.getElementById('max');
  const shotRow = document.getElementById('shotRow');
  const hint = document.getElementById('hint');

  const overlay = document.getElementById('overlay');
  const cardHome = document.getElementById('cardHome');
  const cardEnd  = document.getElementById('cardEnd');
  const endTotal = document.getElementById('endTotal');
  const endList  = document.getElementById('endList');

  const btnStart     = document.getElementById('btnStart');
  const btnRestart   = document.getElementById('btnRestart');
  const btnHome      = document.getElementById('btnHome');
  const btnPlayAgain = document.getElementById('btnPlayAgain');
  const btnBackHome  = document.getElementById('btnBackHome');

  const MAX_SHOTS = 5;
  maxEl.textContent = MAX_SHOTS;

  let TARGET_R = 170;

  /* âœ… ØµØºÙ‘Ø±Ù†Ø§ Ø§Ù„Ù‡Ø¯Ù Ø´ÙˆÙŠ */
  const TARGET_SCALE = 0.64;

  /* âœ… ØµØºÙ‘Ø±Ù†Ø§ Ø§Ù„ØªØµÙˆÙŠØ¨ Ø´ÙˆÙŠ */
  const CROSS_R_OUT = 42;
  const CROSS_R_IN  = 19;
  const CROSS_LINE  = 22;
  const CROSS_THICK = 3;

  const OUTSIDE_MARGIN = 9;
  const RINGS = 10;

  let W=0, H=0, dpr=1;
  let running = false;
  let shots = [];
  let total = 0;

  /* âœ… Ø³Ø±Ù‘Ø¹Ù†Ø§ Ø§Ù„ØªØµÙˆÙŠØ¨ Ø´ÙˆÙŠ */
  let aim = { x: 0, y: 0, dir: 1, speed: 3.6 };

  const holes = [];
  const target = { cx: 0, cy: 0 };

  function resize(){
    dpr = window.devicePixelRatio || 1;
    W = window.innerWidth; H = window.innerHeight;
    canvas.width = Math.floor(W*dpr);
    canvas.height = Math.floor(H*dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const minSide = Math.min(W, H);
    TARGET_R = Math.floor(minSide * 0.30 * TARGET_SCALE);

    target.cx = W/2;
    target.cy = H/2;

    aim.y = target.cy;
    aim.x = target.cx - (TARGET_R + OUTSIDE_MARGIN);
  }

  function buildShotRow(){
    shotRow.innerHTML = '';
    for(let i=0;i<MAX_SHOTS;i++){
      const d = document.createElement('div');
      d.className = 'slot q';
      d.textContent = '?';
      shotRow.appendChild(d);
    }
  }

  function updateHUD(){
    totalEl.textContent = total;
    countEl.textContent = shots.length;

    const children = [...shotRow.children];
    for(let i=0;i<MAX_SHOTS;i++){
      if(shots[i]){
        children[i].className = 'slot';
        children[i].textContent = shots[i].score;
      }else{
        children[i].className = 'slot q';
        children[i].textContent = '?';
      }
    }
  }

  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

  function scoreFromDistance(dist){
    const step = TARGET_R / RINGS;
    const ringIndex = Math.floor(dist / step);
    const val = clamp(RINGS - ringIndex, 1, RINGS);
    return val;
  }

  function drawTarget(){
    const colors = ['#FFFFFF','#000000','#FFFFFF','#000000','#27C7D5','#FF1E1E','#FFD400'];
    const bands = 7;

    for(let i=0;i<bands;i++){
      const outer = TARGET_R - (TARGET_R * (i / bands));
      const inner = TARGET_R - (TARGET_R * ((i+1) / bands));
      ctx.beginPath();
      ctx.arc(target.cx, target.cy, outer, 0, Math.PI*2);
      ctx.fillStyle = colors[i] || '#fff';
      ctx.fill();

      ctx.globalCompositeOperation = 'destination-out';
      ctx.beginPath();
      ctx.arc(target.cx, target.cy, inner, 0, Math.PI*2);
      ctx.fill();
      ctx.globalCompositeOperation = 'source-over';
    }

    ctx.lineWidth = 2;
    ctx.strokeStyle = 'rgba(0,0,0,0.25)';
    for(let k=1;k<=6;k++){
      ctx.beginPath();
      ctx.arc(target.cx, target.cy, (TARGET_R*(k/7)), 0, Math.PI*2);
      ctx.stroke();
    }
  }

  function drawHole(h){
    ctx.save();
    ctx.translate(h.x, h.y);

    ctx.beginPath();
    ctx.arc(2, 2, h.r+2, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fill();

    ctx.beginPath();
    ctx.arc(0, 0, h.r+1.6, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(70,70,70,0.9)';
    ctx.fill();

    ctx.beginPath();
    ctx.arc(0, 0, h.r, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(10,10,10,0.98)';
    ctx.fill();

    ctx.strokeStyle = 'rgba(0,0,0,0.45)';
    ctx.lineWidth = 1;
    for(let i=0;i<5;i++){
      const a = Math.random()*Math.PI*2;
      const len = h.r + 5 + Math.random()*6;
      ctx.beginPath();
      ctx.moveTo(Math.cos(a)*h.r*0.2, Math.sin(a)*h.r*0.2);
      ctx.lineTo(Math.cos(a)*len, Math.sin(a)*len);
      ctx.stroke();
    }

    ctx.restore();
  }

  function drawCrosshair(x,y){
    ctx.save();
    ctx.translate(x,y);

    /* âœ… Ø§Ù„ØªØµÙˆÙŠØ¨ Ø£Ø­Ù…Ø± */
    ctx.strokeStyle = 'rgba(255,0,0,0.90)';
    ctx.lineWidth = CROSS_THICK;

    ctx.beginPath();
    ctx.arc(0,0,CROSS_R_OUT,0,Math.PI*2);
    ctx.stroke();

    ctx.lineWidth = Math.max(2, CROSS_THICK-1);
    ctx.beginPath();
    ctx.arc(0,0,CROSS_R_IN,0,Math.PI*2);
    ctx.stroke();

    ctx.lineWidth = CROSS_THICK;
    ctx.beginPath(); ctx.moveTo(-CROSS_R_OUT-CROSS_LINE,0); ctx.lineTo(-CROSS_R_OUT+6,0); ctx.stroke();
    ctx.beginPath(); ctx.moveTo( CROSS_R_OUT-6,0); ctx.lineTo( CROSS_R_OUT+CROSS_LINE,0); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0,-CROSS_R_OUT-CROSS_LINE); ctx.lineTo(0,-CROSS_R_OUT+6); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0, CROSS_R_OUT-6); ctx.lineTo(0, CROSS_R_OUT+CROSS_LINE); ctx.stroke();

    /* âœ… Ø§Ù„Ù†Ù‚Ø·Ø© Ø¨Ø§Ù„Ù†Øµ Ø£Ø­Ù…Ø± */
    ctx.fillStyle = 'rgba(255,0,0,0.95)';
    ctx.beginPath();
    ctx.arc(0,0,3.2,0,Math.PI*2);
    ctx.fill();

    ctx.restore();
  }

  function resetRound(){
    shots = [];
    total = 0;
    holes.length = 0;
    updateHUD();
    hint.style.opacity = 0.85;

    aim.dir = 1;
    aim.speed = 3.6;
    aim.x = target.cx - (TARGET_R + OUTSIDE_MARGIN);
    aim.y = target.cy;
  }

  function goHomeOverlay(){
    running = false;
    overlay.style.display = 'flex';
    cardHome.style.display = 'block';
    cardEnd.style.display = 'none';
  }

  function startGame(){
    resetRound();
    running = true;
    overlay.style.display = 'none';
  }

  function endRound(){
    running = false;
    overlay.style.display = 'flex';
    cardHome.style.display = 'none';
    cardEnd.style.display = 'block';
    endTotal.textContent = total;

    endList.innerHTML = '';
    shots.forEach((s, i) => {
      const t = document.createElement('div');
      t.className = 'tag';
      t.textContent = `${i+1}) ${s.score}`;
      endList.appendChild(t);
    });
  }

  function shoot(){
    if(!running) return;
    if(shots.length >= MAX_SHOTS) return;

    const x = aim.x;
    const y = aim.y;

    const dx = x - target.cx;
    const dy = y - target.cy;
    const dist = Math.hypot(dx,dy);

    const score = scoreFromDistance(dist);
    shots.push({score, x, y});
    total += score;

    holes.push({x, y, r: 6});

    updateHUD();
    if(shots.length === 1) hint.style.opacity = 0;

    if(shots.length >= MAX_SHOTS) endRound();
  }

  function updateAim(){
    const leftBound  = target.cx - (TARGET_R + OUTSIDE_MARGIN);
    const rightBound = target.cx + (TARGET_R + OUTSIDE_MARGIN);

    aim.x += aim.speed * aim.dir;
    if(aim.x >= rightBound){
      aim.x = rightBound;
      aim.dir = -1;
    }else if(aim.x <= leftBound){
      aim.x = leftBound;
      aim.dir = 1;
    }
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    ctx.beginPath();
    ctx.arc(target.cx+6, target.cy+10, TARGET_R*1.02, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(0,0,0,0.25)';
    ctx.fill();

    drawTarget();

    for(const h of holes) drawHole(h);

    if(running) drawCrosshair(aim.x, aim.y);

    ctx.beginPath();
    ctx.arc(target.cx, target.cy, TARGET_R*1.02, 0, Math.PI*2);
    ctx.strokeStyle = 'rgba(255,255,255,0.18)';
    ctx.lineWidth = 2;
    ctx.stroke();
  }

  function loop(){
    if(running) updateAim();
    draw();
    requestAnimationFrame(loop);
  }

  function onPointerDown(e){
    const t = e.target;
    if(t && t.tagName === 'BUTTON') return;
    shoot();
  }

  window.addEventListener('keydown', (e) => {
    if(e.code === 'Space'){
      e.preventDefault();
      shoot();
    }
  });

  btnStart.addEventListener('click', startGame);

  btnRestart.addEventListener('click', () => { startGame(); });
  btnPlayAgain.addEventListener('click', () => { startGame(); });

  /* âœ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙŠØ±Ø¬Ø¹ Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ */
  btnHome.addEventListener('click', () => { location.href = HOME_URL; });
  btnBackHome.addEventListener('click', () => { location.href = HOME_URL; });

  canvas.addEventListener('pointerdown', onPointerDown);

  window.addEventListener('resize', () => {
    resize();
    aim.y = target.cy;
  });

  buildShotRow();
  resize();
  updateHUD();
  goHomeOverlay();
  loop();
})();
</script>

</body>
</html>
